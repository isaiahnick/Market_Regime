-- Check when each category starts, based on limiting factor
SELECT 
    category,
    MIN(date) as start_date,
    MAX(date) as end_date,
    COUNT(*) as n_observations
FROM pca_factors
WHERE value IS NOT NULL
GROUP BY category
ORDER BY start_date;

-- Find individual factor with latest start date
SELECT 
    i.category,
    i.proxy,
    MIN(p.date) as start_date,
    MAX(p.date) as end_date,
    COUNT(*) as n_observations
FROM prices p
JOIN instruments i ON p.instrument_id = i.instrument_id
WHERE p.value IS NOT NULL
GROUP BY i.category, i.proxy
ORDER BY i.category, start_date;